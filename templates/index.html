{% extends "base.html" %}
{% block content %}
<section class="grid">
  <div class="card">
    <h2>Camera</h2>
    <div style="text-align: center;">
      <button type="button" id="startButton" onclick="initPoseModel()">Start Camera</button>
      <button type="button" id="stopButton" onclick="stopPoseModel()" style="display: none;">Stop</button>
    </div>
    <div style="margin-top: 1rem; text-align: center;">
      <canvas id="canvas" width="400" height="400" style="max-width: 100%; border: 2px solid #ddd; border-radius: 8px; background: #f0f0f0;"></canvas>
    </div>
    <div id="label-container" style="margin-top: 0.5rem; font-size: 0.9rem; text-align: center;"></div>
    <p class="muted small" id="modelStatus" style="text-align: center;">Click "Start Camera & Model" to begin</p>
  </div>

  <div class="card">
    <h2>Live Status</h2>
    <div id="statusBadge" class="badge">Loading…</div>
    <p class="muted">Threshold: <span id="threshold">{{ slouch_threshold }}</span></p>
    <div class="gauge">
      <div class="gauge-bar">
        <div id="gaugeFill" class="gauge-fill" style="width: 0%"></div>
      </div>
      <div class="gauge-label">
        Slouch Probability: <span id="slouchProb">0.00</span>
      </div>
    </div>
    <p class="muted small">Last sample: <span id="lastTs">—</span></p>
  </div>


  <div class="card">
    <h2>Last 30 Minutes</h2>
    <canvas id="tsChart"></canvas>
    <div class="metrics-row">
      <div id="metricSlouch" class="metric-pill">Slouching: --%</div>
      <div id="metricGood" class="metric-pill">Good posture: --%</div>
    </div>
  </div>


  <div class="card">
    <h2>Recent Events</h2>
    <table class="table">
      <thead>
        <tr><th>Time (UTC)</th><th>Type</th><th>Prob</th></tr>
      </thead>
      <tbody id="eventsBody"><tr><td colspan="3">Loading…</td></tr></tbody>
    </table>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/pose@0.8/dist/teachablemachine-pose.min.js"></script>
<script>window.SLOUCH_THRESHOLD = parseFloat("{{ slouch_threshold }}");</script>
<script src="/static/app.js"></script>
{% endblock %}
